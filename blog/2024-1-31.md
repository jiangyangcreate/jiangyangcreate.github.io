---
title: åšå®¢æ–‡æœ¬æ‘˜è¦
date: 2024-1-31
authors: jiangmiemie
tags: [blog, tutorial]
keywords: [blog, tutoria]
description: è®°å½•è‡ªå·±åšå®¢å¦‚ä½•å®ç°ç”Ÿæˆå¼AIæ–‡æœ¬æ‘˜è¦
---

å‰æ®µæ—¶é—´å¶ç„¶é—´çœ‹åˆ°äº†ä¸€äº›ç”Ÿæˆå¼ AI æ–‡æœ¬æ‘˜è¦é¡¹ç›®ï¼Œè§‰å¾—å¾ˆæœ‰æ„æ€ã€‚ä¸ªäººä¸å¤ªä¿¡ä»»ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œäºæ˜¯å°±åŠ åˆ°å¾…åŠé‡Œï¼Œæƒ³ç€è‡ªå·±ä¹Ÿå®ç°ä¸€ä¸ªï¼Œæœ€è¿‘ç»ˆäºæœ‰ç©ºäº†ã€‚

é€»è¾‘ä¸Šçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ï¼šè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼Œä¸€æ¬¡ç”Ÿæˆï¼Œå†æ¬¡ç”Ÿæˆæ¶ˆè€— key
æ ·å¼ä¸Šçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ï¼šé€å­—æ˜¾ç¤ºï¼Œå¥½åƒæ˜¯ä¸ªæœºå™¨äººçœŸçš„åœ¨å®æ—¶ç”Ÿæˆã€‚

åšå®¢æ˜¯åŸºäº Docusaurus æ­å»ºçš„ï¼Œè€Œ Docusaurus æ˜¯åŸºäº React çš„ï¼Œæ–‡ç« å†…å®¹æ˜¯é€šè¿‡ markdown æ–‡ä»¶å†™çš„ï¼Œæ‰€ä»¥éœ€è¦è®¾è®¡ä¸€ä¸ª React ç»„ä»¶ï¼Œä¼ å…¥ markdown æ–‡ä»¶å°†å…¶è½¬æ¢ä¸ºæ–‡æœ¬æ‘˜è¦ã€‚

```js showLineNumbers
// å¤§è‡´å¦‚ä¸‹
function TextSummarizer({text ,key}) {
  const [summary, setSummary] = useState("");

  useEffect(() => {
    const summarizeText = async () => {
      const response = await axios.post(
        `https://api.your-ai-service.com/user?api_key=${key}&text=${text}&length=100`,
      );
      setSummary(response.data.summary);
    };

    summarizeText();
  }, [text]);

  return (
    <div>
      {summary && <p>{summary}</p>}
    </div>
  );
}

export default TextSummarizer;
// è°ƒç”¨
<TextSummarizer text="This is the text to summarize" key='key' />
```

ä½†æ˜¯è¿™æ ·åšä¸€äº›é—®é¢˜ï¼Œä¸»è¦çš„æ˜¯é‡å¤çš„æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ¶ˆè€— keyï¼Œå› æ­¤éœ€è¦å‚¨å­˜å·²è¯·æ±‚å†…å®¹ï¼Œå­˜å‚¨çš„ç»“æ„å¤§æ¦‚åº”è¯¥æ˜¯`å†…å®¹ï¼šæ‘˜è¦`ï¼Œå¦‚ï¼š

```js showLineNumbers
{
  "This is the text to summarize": "This is the summary",
  "This is the text to summarize 2": "This is the summary 2",
}
```
åˆ¤æ–­æ¡ä»¶å¯ä»¥è®¾ä¸ºå¦‚æœå†…å®¹ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è°ƒç”¨ï¼Œå¦åˆ™å°±é‡æ–°ç”Ÿæˆï¼Œç„¶åå­˜å‚¨ã€‚

æŠŠè¿™ä¸ªä»£ç é€»è¾‘æ’å…¥åˆ° React ç»„ä»¶ä¸­å°±å¯ä»¥å®ç°äº†ï¼Œæ ¹æ®ä½ è°ƒç”¨çš„APIä¸åŒï¼Œä½ ä¹Ÿè®¸å¯ä»¥è®¾ç½®è¿”å›çš„æ‘˜è¦é•¿åº¦ç­‰å‚æ•°ã€‚

è®°å¾—åˆ«ç›´æ¥æŠŠkeyå†™åœ¨ä»£ç é‡Œï¼Œè€Œæ˜¯é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥ã€‚å¦‚æœä½ çš„é¡¹ç›®é€šè¿‡github pageséƒ¨ç½²ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨é¡¹ç›®çš„settingä¸­è®¾ç½®ç¯å¢ƒå˜é‡`REACT_APP_API_KEY`ï¼Œç„¶ååœ¨ä»£ç ä¸­é€šè¿‡`process.env.REACT_APP_API_KEY`æ¥è·å–ã€‚

å½“ç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªæ¯”è¾ƒç²—ç³™çš„æƒ³æ³•ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬å®Œå–„ä¸‹ä»£ç ç»†èŠ‚ï¼Œè®©å®ƒä¼˜é›…çš„åŒæ—¶ï¼Œå¯ä»¥åœ¨åšå®¢ä¸­ä½¿ç”¨ã€‚

æˆ‘åœ¨[https://github.com/reflex-dev/reflex-chat/pull/20](https://github.com/reflex-dev/reflex-chat/pull/20)é‡Œæäº¤äº†å…³äºç™¾åº¦APIçš„å®ç°ï¼Œè¿™é‡Œç›´æ¥å¤ç°ä¸‹æ ¸å¿ƒä»£ç ã€‚

å®Œæ•´ä»£ç å‚è€ƒæˆ‘çš„[github](https://github.com/jiangyangcreate/jiangyangcreate)


```python showLineNumbers
import os
import json
import requests
from parsel import Selector


class BaiduAI:
    def __init__(self):
        self.BAIDU_API_KEY = os.getenv("BAIDU_API_KEY")
        self.BAIDU_SECRET_KEY = os.getenv("BAIDU_SECRET_KEY")
        self.token = self.get_access_token()

    def get_access_token(self):
        """
        :return: access_token
        """
        url = "https://aip.baidubce.com/oauth/2.0/token"
        params = {
            "grant_type": "client_credentials",
            "client_id": self.BAIDU_API_KEY,
            "client_secret": self.BAIDU_SECRET_KEY,
        }
        return str(requests.post(url, params=params).json().get("access_token"))

    def get_result(self, text: str):
        messages = json.dumps(
            {
                "messages": [
                    {
                        "role": "user",
                        "content": "é˜…è¯»ä¸‹é¢çš„åšæ–‡ï¼Œç„¶åå°½å¯èƒ½æ¥è¿‘50ä¸ªè¯çš„èŒƒå›´å†…ï¼Œæä¾›ä¸€ä¸ªæ€»ç»“ã€‚åªéœ€è¦å›å¤æ€»ç»“åçš„æ–‡æœ¬ï¼š{}".format(
                            text
                        ),
                    }
                ]
            }
        )
        session = requests.request(
            "POST",
            "https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions_pro?access_token="
            + self.token,
            headers={"Content-Type": "application/json"},
            data=messages,
        )
        json_data = json.loads(session.text)
        if "result" in json_data.keys():
            answer_text = json_data["result"]
        return answer_text


def get_summary(content: str) -> str:
    selector = Selector(text=content)
    content_format = "".join(selector.xpath(".//text()").getall())
    ai = BaiduAI()
    summary = ai.get_result(content_format)
    return summary


def summary(feed_content):
    json_file_path = "output.json"

    # å¦‚æœJSONæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç©ºçš„JSONæ–‡ä»¶
    if not os.path.exists(json_file_path):
        with open(json_file_path, "w", encoding="utf-8") as new_json_file:
            json.dump({}, new_json_file)

    # è¯»å–JSONæ–‡ä»¶å¹¶å°†å…¶è½¬æ¢ä¸ºPythonå­—å…¸
    with open(json_file_path, "r", encoding="utf-8") as json_file:
        loaded_dict = json.load(json_file)

    for page in feed_content:
        url = page["link"].split("#")[0]
        content = page["content"][0]["value"]
        content_hash = hash(content)
        if (
            loaded_dict.get(url)
            and loaded_dict.get(url).get("content_hash") == content_hash
        ):
            continue
        else:
            summary = get_summary(content)
            loaded_dict.update({url: {content_hash: summary}})
    # å°†å­—å…¸å­˜å…¥JSONæ–‡ä»¶
    with open(json_file_path, "w", encoding="utf-8") as json_file:
        json.dump(loaded_dict, json_file, indent=4)
```


ç›¸å…³å·¥ä½œæµè®¾ç½®ï¼Œå½“ç„¶è¿™ä¸ªå·¥ä½œæµçš„è§¦å‘æ¨¡å¼åé¢ä¼šè°ƒæ•´ï¼š

```yaml showLineNumbers
name: Build README

on:
  push:
  workflow_dispatch:
  schedule:
    - cron: '0 16 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
    - name: Check out repo
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.8

    - uses: actions/cache@v2
      name: Configure pip caching
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: Install Python dependencies
      run: |
        python -m pip install -r requirements.txt

    - name: Update README
      run: |-
        python build_readme.py
        cat README.md
        cat README_zh.md
      env:
        BAIDU_API_KEY: ${{ secrets.BAIDU_API_KEY }}
        BAIDU_SECRET_KEY: ${{ secrets.BAIDU_SECRET_KEY }}

    - name: Commit and push if changed
      run: |-
        git diff
        git config --global user.email "jiangyangcreate@gmail.com"
        git config --global user.name "jiangyang-bot"
        git pull
        git add -A
        git commit -m "ğŸ’¬ Updated content" || exit 0
        git push
```