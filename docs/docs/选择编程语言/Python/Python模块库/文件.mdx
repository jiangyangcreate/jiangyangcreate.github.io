# æ–‡ä»¶

### os æ¨¡å—

åº“ã€åŒ…ã€æ¨¡å—çš„åŒ…å«å…³ç³»ä¸ºï¼šå¤šä¸ªæ¨¡å—ç»„æˆä¸ºåŒ…ã€å¤šä¸ªåŒ…ç»„æˆä¸ºåº“ã€‚

åœ¨å®é™…å¼€å‘ä¸­ä¸åšä¸¥æ ¼åŒºåˆ†ã€‚

Python æ ‡å‡†åº“ï¼šPython å†…ç½®çš„åº“ï¼Œä¸éœ€è¦å®‰è£…ï¼Œç›´æ¥å¯¼å…¥å³å¯ä½¿ç”¨ã€‚

ä»¥ Python çš„å†…ç½® os æ¨¡å—ä¸ºä¾‹ï¼Œæ˜¯ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„æ¨¡å—ï¼Œä¸»è¦æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š

#### æ–‡ä»¶è·¯å¾„æ“ä½œ

- os.remove(path) æˆ– os.unlink(path) ï¼šåˆ é™¤æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ã€‚è·¯å¾„å¯ä»¥æ˜¯å…¨åï¼Œä¹Ÿå¯ä»¥æ˜¯å½“å‰å·¥ä½œç›®å½•ä¸‹çš„è·¯å¾„ã€‚
- os.removedirsï¼šåˆ é™¤æ–‡ä»¶ï¼Œå¹¶åˆ é™¤ä¸­é—´è·¯å¾„ä¸­çš„ç©ºæ–‡ä»¶å¤¹
- os.chdir(path)ï¼šå°†å½“å‰å·¥ä½œç›®å½•æ”¹å˜ä¸ºæŒ‡å®šçš„è·¯å¾„
- os.getcwd()ï¼šè¿”å›å½“å‰çš„å·¥ä½œç›®å½•
- os.curdirï¼šè¡¨ç¤ºå½“å‰ç›®å½•çš„ç¬¦å·
- os.rename(old, new)ï¼šé‡å‘½åæ–‡ä»¶
- os.renames(old, new)ï¼šé‡å‘½åæ–‡ä»¶ï¼Œå¦‚æœä¸­é—´è·¯å¾„çš„æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶å¤¹
- os.listdir(path)ï¼šè¿”å›ç»™å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹å’Œæ–‡ä»¶åï¼Œä¸åŒ…æ‹¬ '.' å’Œ '..' ä»¥åŠå­æ–‡ä»¶å¤¹ä¸‹çš„ç›®å½•ã€‚ï¼ˆ'.' å’Œ '..' åˆ†åˆ«æŒ‡å½“å‰ç›®å½•å’Œçˆ¶ç›®å½•ï¼‰
- os.mkdir(name)ï¼šäº§ç”Ÿæ–°æ–‡ä»¶å¤¹
- os.makedirs(name)ï¼šäº§ç”Ÿæ–°æ–‡ä»¶å¤¹ï¼Œå¦‚æœä¸­é—´è·¯å¾„çš„æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶å¤¹

å¯¼å…¥è¯¥æ¨¡å—ï¼š

```python showLineNumbers
import os
```

äº§ç”Ÿæ–‡ä»¶ï¼š

```python showLineNumbers
f = open('test.file', 'w')
f.close()
print('test.file' in os.listdir(os.curdir))
```

é‡å‘½åæ–‡ä»¶:

```python showLineNumbers
os.rename("test.file", "test.new.file")
print("test.file" in os.listdir(os.curdir))
print("test.new.file" in os.listdir(os.curdir))
```

```python showLineNumbers
# åˆ é™¤æ–‡ä»¶
os.remove("test.new.file")
```

#### ç³»ç»Ÿå¸¸é‡

- windows ä¸º \r\n
- unix ä¸º \n

```python showLineNumbers
os.linesep
```

```python showLineNumbers
# å½“å‰æ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦ï¼š
os.sep
```

å½“å‰æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸­çš„åˆ†éš”ç¬¦ï¼ˆ';' æˆ– ':'ï¼‰ï¼š

- windows ä¸º ;
- unix ä¸º:

```python showLineNumbers
os.pathsep
```

os.environ æ˜¯ä¸€ä¸ªå­˜å‚¨æ‰€æœ‰ç¯å¢ƒå˜é‡çš„å€¼çš„å­—å…¸ï¼Œå¯ä»¥ä¿®æ”¹ã€‚

```python showLineNumbers
os.environ
```

#### os.path æ¨¡å—

```python showLineNumbers
import os.path
```

- os.path.isfile(path) ï¼šæ£€æµ‹ä¸€ä¸ªè·¯å¾„æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶
- os.path.isdir(path)ï¼šæ£€æµ‹ä¸€ä¸ªè·¯å¾„æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹
- os.path.exists(path)ï¼šæ£€æµ‹è·¯å¾„æ˜¯å¦å­˜åœ¨
- os.path.isabs(path)ï¼šæ£€æµ‹è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„

windows ç³»ç»Ÿï¼š

```python showLineNumbers
print(os.path.isfile("C:/Windows"))
print(os.path.isdir("C:/Windows"))
print(os.path.exists("C:/Windows"))
print(os.path.isabs("C:/Windows"))
```

unix ç³»ç»Ÿï¼š

```python showLineNumbers
print(os.path.isfile("/Users"))
print(os.path.isdir("/Users"))
print(os.path.exists("/Users"))
print(os.path.isabs("/Users"))
```

#### split å’Œ join

- os.path.split(path)ï¼šæ‹†åˆ†ä¸€ä¸ªè·¯å¾„ä¸º (head, tail) ä¸¤éƒ¨åˆ†
- os.path.join(a, \*p)ï¼šä½¿ç”¨ç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦ï¼Œå°†å„ä¸ªéƒ¨åˆ†åˆæˆä¸€ä¸ªè·¯å¾„

```python showLineNumbers
head, tail = os.path.split("c:/tem/b.txt")
print(head, tail)
```

```python showLineNumbers
a = "c:/tem"
b = "b.txt"
os.path.join(a, b)
```

```python showLineNumbers
def get_files(dir_path):
    '''
    åˆ—å‡ºæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
    :param dir_path: çˆ¶æ–‡ä»¶å¤¹è·¯å¾„
    :return:
    '''
    for parent, dirname, filenames in os.walk(dir_path):
        for filename in filenames:
            print("parent is:", parent)
            print("filename is:", filename)
            print("full name of the file is:", os.path.join(parent, filename))
```

åˆ—å‡ºå½“å‰æ–‡ä»¶å¤¹çš„æ‰€æœ‰æ–‡ä»¶ï¼š

```python showLineNumbers
dir = os.curdir
get_files(dir)
```

#### Byte Code ç¼–è¯‘

Python, Java ç­‰è¯­è¨€å…ˆå°†ä»£ç ç¼–è¯‘ä¸º byte codeï¼ˆä¸æ˜¯æœºå™¨ç ï¼‰ï¼Œç„¶åå†å¤„ç†ï¼š

> .py -> .pyc -> interpreter

eval(statement, glob, local)

ä½¿ç”¨ eval å‡½æ•°åŠ¨æ€æ‰§è¡Œä»£ç ï¼Œè¿”å›æ‰§è¡Œçš„å€¼ã€‚

exec(statement, glob, local)

ä½¿ç”¨ exec å¯ä»¥æ·»åŠ ä¿®æ”¹åŸæœ‰çš„å˜é‡:

```python showLineNumbers
a = 1
exec('b = a + 10')
print(b)
```

```python showLineNumbers
local = dict(a=2)
glob = {}
exec("b = a+1", glob, local)

print(local)
```

compile å‡½æ•°ç”Ÿæˆ byte codeï¼š
compile(str, filename, mode)

```python showLineNumbers
a = 1
b = compile('a+2', '', 'eval')
print(eval(b))
```

```python showLineNumbers
a = 1
c = compile("b=a+4", "", 'exec')
exec(c)
print(b)
```

```python showLineNumbers
# abstract syntax trees
import ast

tree = ast.parse('a+10', '', 'eval')
ast.dump(tree)
```

```python showLineNumbers
a = 1
c = compile(tree, '', 'eval')
d = eval(c)
print(d)
```

```python showLineNumbers
# å®‰å…¨çš„ä½¿ç”¨æ–¹æ³• literal_eval ï¼Œåªæ”¯æŒåŸºæœ¬å€¼çš„æ“ä½œï¼š
b = ast.literal_eval('[10.0, 2, True, "foo"]')
print(b)
```

### open

#### å†™æ–‡ä»¶

æˆ‘ä»¬ä½¿ç”¨ open å‡½æ•°çš„å†™å…¥æ¨¡å¼æ¥å†™æ–‡ä»¶ï¼š

```python showLineNumbers
f = open('test.txt', 'w')
f.write('hello world.')
f.close()
```

```python showLineNumbers
print(open('test.txt').read())
```

ä½¿ç”¨ w æ¨¡å¼æ—¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šè¢«åˆ›å»º

é™¤äº†å†™å…¥æ¨¡å¼ï¼Œè¿˜æœ‰è¿½åŠ æ¨¡å¼ a

è¯»å†™æ¨¡å¼ w+

```python showLineNumbers
f = open('test.txt', 'w+')
f.write('hello world. morning.')
f.seek(3)
print(f.read())  # hello world.
f.close()
```

#### è¯»æ–‡ä»¶

ä½¿ç”¨ open å‡½æ•° æ¥è¯»æ–‡ä»¶ï¼Œä½¿ç”¨æ–‡ä»¶åçš„å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥å‚æ•°ï¼š

é»˜è®¤æ‰“å¼€æ–‡ä»¶æ˜¯ â€˜râ€™ è¯»æ¨¡å¼

```python showLineNumbers
f = open("test.txt")

# é»˜è®¤ä»¥è¯»çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šæŠ¥é”™ã€‚
# å¯ä»¥ä½¿ç”¨ read æ–¹æ³•æ¥è¯»å…¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹ï¼š
text = f.read()
print(text)
```

æŒ‰ç…§è¡Œè¯»å…¥å†…å®¹ï¼Œreadlines æ–¹æ³•è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨æ–‡ä»¶ä¸­æ¯ä¸€è¡Œçš„å†…å®¹ï¼š

```python showLineNumbers
f = open("test.txt")
lines = f.readlines()
print(lines)
f.close()
```

```python showLineNumbers
# äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å°† f æ”¾åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå¾—åˆ°å®ƒæ¯ä¸€è¡Œçš„å†…å®¹ï¼š
f = open('test.txt')
for line in f:
    print(line)
f.close()
```

#### ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python showLineNumbers
with open('my_file.txt', 'w') as fp:
    data = fp.write("Hello world")
```

è¿™ç­‰æ•ˆäºä¸‹é¢çš„ä»£ç ï¼Œä½†æ˜¯è¦æ›´ç®€ä¾¿ï¼š

```python showLineNumbers
fp = open('my_file.txt', 'w')
try:
    # do stuff with f
    data = fp.write("Hello world")
finally:
    fp.close()
```

#### è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨

æ¯”å¦‚å¯ä»¥è¿™æ ·å®šä¹‰ä¸€ä¸ªç®€å•çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š

```python showLineNumbers
class ContextManager(object):
    def __enter__(self):
        print("Entering")

    def __exit__(self, exc_type, exc_value, traceback):
        print("Exiting")


with ContextManager():
    print("inside operate")
```

#### **enter** çš„è¿”å›å€¼

å¦‚æœåœ¨ **enter** æ–¹æ³•ä¸‹æ·»åŠ äº†è¿”å›å€¼ï¼Œ

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ as æŠŠè¿™ä¸ªè¿”å›å€¼ä¼ ç»™æŸä¸ªå‚æ•°ï¼š

```python showLineNumbers
class ContextManager2(object):
    def __enter__(self):
        print("Entering")
        return "my value"

    def __exit__(self, exc_type, exc_value, traceback):
        print("Exiting")


with ContextManager2() as val:
    print(val)

```

ä¸€ä¸ªé€šå¸¸çš„åšæ³•æ˜¯å°† **enter** çš„è¿”å›å€¼è®¾ä¸ºè¿™ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡æœ¬èº«ï¼Œ
æ–‡ä»¶å¯¹è±¡å°±æ˜¯è¿™æ ·åšçš„.

```python showLineNumbers
class ContextManager3(object):
    def __enter__(self):
        print("Entering")
        return self

    def __exit__(self, exc_type, exc_value, traceback):
        print("Exiting")

```

#### é”™è¯¯å¤„ç†

ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡å°†é”™è¯¯å¤„ç†äº¤ç»™ **exit** è¿›è¡Œï¼Œå¯ä»¥å°†é”™è¯¯ç±»å‹ï¼Œ
é”™è¯¯å€¼å’Œ traceback ç­‰å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ **exit** å‡½æ•°ï¼š

```python showLineNumbers
class ContextManager4(object):
    def __enter__(self):
        print("Entering")

    def __exit__(self, exc_type, exc_value, traceback):
        print("Exiting")
        if exc_type is not None:
            print("  Exception:", exc_value)
            return True  # ä¸æƒ³è®©é”™è¯¯æŠ›å‡ºï¼Œåªéœ€è¦å°† __exit__ çš„è¿”å›å€¼è®¾ä¸º True


with ContextManager4():
    print(1 / 0)

```

```python showLineNumbers
import os
os.remove('my_file.txt')
```

#### äºŒè¿›åˆ¶æ–‡ä»¶

äºŒè¿›åˆ¶è¯»å†™æ¨¡å¼ bï¼š

```python showLineNumbers
import os

f = open('binary.bin', 'wb')
f.write(os.urandom(10))
f.close()
```

```python showLineNumbers
f = open('binary.bin', 'rb')
print(repr(f.read()))
f.close()
```

#### with æ–¹æ³•

äº‹å®ä¸Šï¼ŒPython æä¾›äº†æ›´å®‰å…¨çš„æ–¹æ³•ï¼Œå½“ with å—çš„å†…å®¹ç»“æŸåï¼Œ
Python ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒçš„ close æ–¹æ³•ï¼Œç¡®ä¿è¯»å†™çš„å®‰å…¨ï¼š

```python showLineNumbers
with open('new_file.txt', 'w') as f:
    for i in range(3000):
        x = 1.0 / (i - 1000)
        f.write('hello world: ' + str(i) + '\n')
```

ä¸ try/exception/finally æ•ˆæœç›¸åŒï¼Œä½†æ›´ç®€å•ã€‚

æŸ¥çœ‹æ–‡ä»¶å†™çš„ç»“æœï¼Œè™½ç„¶è§¦å‘ errorï¼Œä½†å·²ç»å†™çš„å†…å®¹æ˜¯æˆåŠŸçš„ã€‚

```python showLineNumbers
!tail new_file.txt
```

```python showLineNumbers
!wc -l new_file.txt
```

```python showLineNumbers
# åˆ é™¤æ–‡ä»¶ï¼š
import os
os.remove('test.txt')
os.remove('binary.bin')
os.remove('new_file.txt')
```


### ğŸš§tempfile æ¨¡å—

tempfile æ¨¡å—æ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºåˆ›å»ºå’Œæ“ä½œä¸´æ—¶æ–‡ä»¶å’Œç›®å½•ã€‚å®ƒå¯ä»¥å¸®åŠ©ç¨‹åºå‘˜åœ¨è¿è¡Œæ—¶ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤è¿™äº›æ–‡ä»¶ï¼Œä»è€Œé¿å…ç•™ä¸‹ä¸å¿…è¦çš„ä¸´æ—¶æ–‡ä»¶ã€‚tempfile æ¨¡å—ç‰¹åˆ«é€‚ç”¨äºé‚£äº›éœ€è¦åœ¨è¿è¡Œæ—¶åˆ›å»ºä¸´æ—¶æ–‡ä»¶æ¥å­˜å‚¨ä¸­é—´æ•°æ®çš„åº”ç”¨åœºæ™¯ã€‚

### ğŸš§pathlib æ¨¡å—

### ğŸš§shutil æ¨¡å—

### ğŸš§sys æ¨¡å—


### ğŸš§pickle æ¨¡å—

pickle æ¨¡å—æ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ– Python å¯¹è±¡ã€‚å®ƒå¯ä»¥å°† Python å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ä»æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æµå¹¶è½¬æ¢å› Python å¯¹è±¡ã€‚

### ğŸš§sqlite3 æ¨¡å—

sqlite3 æ¨¡å—æ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºè®¿é—® SQLite æ•°æ®åº“ã€‚SQLite æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå®ƒä¸éœ€è¦å•ç‹¬çš„æœåŠ¡å™¨è¿›ç¨‹æˆ–é…ç½®ï¼Œé€‚åˆäºåµŒå…¥å¼ç³»ç»Ÿå’Œå°å‹åº”ç”¨ç¨‹åºã€‚


