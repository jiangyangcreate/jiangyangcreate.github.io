# ç½‘ç»œä¸é€šä¿¡

### ğŸš§webbrowser æ¨¡å—

### urllib æ¨¡å—

urllib æ˜¯ä¸€ä¸ªæ”¶é›†äº†å¤šä¸ªæ¶‰åŠ URL çš„æ¨¡å—çš„è‡ªå¸¦åŒ…ï¼šå¯ä»¥æ‰“å¼€å’Œè¯»å– URLã€ æŠ›å‡ºå¼‚å¸¸ã€è§£æ URLã€è§£æ robots.txt æ–‡ä»¶æ˜¯æœ€åº•å±‚çš„æ¨¡å—ã€‚è™½ç„¶ä»…æ”¯æŒ HTTP1.0 ä»…åŒæ­¥ ï¼Œä½†æ˜¯è§£ç å’Œè§£æåŠŸèƒ½æ˜¯çœŸçš„å¾ˆå¥½ç”¨

[urllib æ¨¡å—ä»£ç æ–‡æ¡£](https://docs.python.org/zh-cn/3/library/urllib.html?highlight=urllib#module-urllib)

#### urllib å‘é€è¯·æ±‚

```python showLineNumbers
import urllib.request

url = 'https://www.python.org'
# æ–¹å¼ä¸€
response = urllib.request.urlopen(url)
print(type(response))  # <class 'http.client.HTTPResponse'>
# æ–¹å¼äºŒ
request = urllib.request.Request(url)
res = urllib.request.urlopen(url)
print(type(res))  # <class 'http.client.HTTPResponse'>
print(response.read())                  # è·å–å“åº”ä½“ äºŒè¿›åˆ¶å­—ç¬¦ä¸²
print(response.getheaders())
# ç»“æœä¸º
[('Connection', 'close'), ('Content-Length', '50064'), ('Server', 'nginx'), ('Content-Type', 'text/html; charset=utf-8'), ('X-Frame-Options', 'DENY'), ('Via', '1.1 vegur, 1.1 varnish, 1.1 varnish'), ('Accept-Ranges', 'bytes'), ('Date', 'Tue, 17 Jan 2023 14:37:33 GMT'), ('Age', '1938'), ('X-Served-By', 'cache-iad-kiad7000025-IAD, cache-nrt-rjtf7700057-NRT'), ('X-Cache', 'HIT, HIT'), ('X-Cache-Hits', '263, 1190'), ('X-Timer', 'S1673966254.566369,VS0,VE0'), ('Vary', 'Cookie'), ('Strict-Transport-Security', 'max-age=63072000; includeSubDomains')]
```

#### urllib å¼‚å¸¸å¤„ç†

URLError æ˜¯ OSError çš„ä¸€ä¸ªå­ç±»ï¼Œæ‰€æœ‰è¯·æ±‚é—®é¢˜éƒ½ä¼šè¢«æ•è·ã€‚

HTTPError æ˜¯ URLError çš„ä¸€ä¸ªå­ç±»ï¼ŒæœåŠ¡å™¨ä¸Š HTTP çš„å“åº”ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼Œæ ¹æ®è¿™ä¸ª HTTP çŠ¶æ€ç æ¥å†³å®šæ˜¯å¦æ•è·ï¼Œæ¯”å¦‚å¸¸è§çš„ 404 é”™è¯¯ç­‰ã€‚

```python showLineNumbers
from urllib import request
from urllib import error

if __name__ == "__main__":
    url = "http://www.iloveyou.com/"#ä¸€ä¸ªä¸å­˜åœ¨çš„è¿æ¥
    req = request.Request(url)
    try:
        response = request.urlopen(req)
        print(response.read())
    except error.URLError as e:
        print(e) # <urlopen error [Errno 11002] getaddrinfo failed>
```

#### urllib è§£æ URL

ä½ è‚¯å®šç»å†è¿‡å¤åˆ¶ç½‘å€å‡ºç°ä¹±ç ï¼Œè¿™æ˜¯å› ä¸ºç½‘å€å¿…é¡»ä»¥é€šç”¨ç çš„å½¢å¼ä¼ é€ï¼Œè€Œä¸”è¿˜è¦é¿å…å‡ ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œå› æ­¤ç½‘å€è¦ç»ç¼–ç ï¼Œæ±‰å­—ç»è¿‡ç¼–ç åè‡ªç„¶å°±æ˜¯ä¸å¯è¾¨è®¤çš„ä¹±ç äº†ã€‚

é‚£ä¹ˆæµè§ˆå™¨çš„åœ°å€æ ä¸­ï¼Œç½‘å€ä¸ºä»€ä¹ˆçœ‹èµ·æ¥æ˜¯ä¸­æ–‡å‘¢ï¼Ÿè¿™å¤§æ¦‚æ˜¯æµè§ˆå™¨çš„â€œäººæ€§åŒ–â€å¤„ç†ï¼Œå°†ç¼–ç å¥½çš„ä¸­æ–‡ç½‘å€è¿˜åŸå‡ºæ¥â€œæš‚æ—¶â€æ˜¾ç¤ºåœ¨åœ°å€æ ä¸­ã€‚

çŸ¥é“åŸç†å°±èƒ½æ¸…æ¥šçš„è§£ç å•¦ï¼Œä½ å¯ä»¥é€šè¿‡ encode å’Œ decode æ–¹æ³•è¿›è¡Œæ“ä½œè§£ç å’Œè½¬ç ï¼Œåªä¸è¿‡è¦è€ƒè™‘æ±‰å­—ä¸­æœ‰%ç­‰ç‰¹æ®Šå­—ç¬¦å’Œ/x ä¸%äº’è½¬çš„æƒ…å†µï¼Œæ‰€ä»¥ï¼Œç›´æ¥ç”¨ quote å‡½æ•°å§ï¼Œåˆ«é‡å¤é€ è½®å­ã€‚

```python showLineNumbers
from urllib.parse import unquote
from urllib.parse import quote

url = 'https://www.baidu.com/s?ie=UTF-8&wd=%E7%A7%91%E6%8A%80&%E6%8A%80%E6%9C%AF'
print(unquote(url))
# ç»“æœä¸ºhttps://www.baidu.com/s?ie=UTF-8&wd=ç§‘æŠ€&æŠ€æœ¯


print( 'https://www.baidu.com/s?ie=UTF-8&wd='+quote('ç§‘æŠ€&æŠ€æœ¯'))
# ç»“æœä¸º'https://www.baidu.com/s?ie=UTF-8&wd=%E7%A7%91%E6%8A%80&%E6%8A%80%E6%9C%AF'
```

#### urllib è§£æ robots.txt æ–‡ä»¶

```python showLineNumbers
import urllib.robotparser
rp = urllib.robotparser.RobotFileParser()
rp.set_url("http://www.musi-cal.com/robots.txt")
rp.read()

print(rp.can_fetch("*", "http://www.musi-cal.com/")) #åˆ¤æ–­ç½‘é¡µæ˜¯å¦å¯ä»¥æŠ“å–ï¼Œ'*'è¡¨ç¤ºé€‚ç”¨äºæ‰€æœ‰çˆ¬è™«
# True
```
